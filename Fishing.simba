{$I WaspLib/osrs.simba}
{$DEFINE WL_DEBUG_UPTEXT}
{$DEFINE WL_Debug_MOUSE}

var
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Section: Fishing Settings
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  //fish : TStringArray := ["Raw anchovies","Raw shrimps"];  //Draynor Village
  fish : TStringArray := ["Raw trout","Raw salmon"];  //Barbarian Village

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Section: Bankstander Settings
// Please fill out the following variables before starting the bot
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  LOGIN_NAME  = 'SuporKiwi';     //Username/Email
  LOGIN_PASS  = '@Brad8928828';  //Password
  PPIN        = '';              //Bank pin

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  profile      : TProfile;

  i : Integer;
  player: TPoint;
  fishSpotsTpa: TPointArray;
  fishingSpots: TRSObjectArray;
  anchorPt:     TPoint;
  bankPt:     TPoint;
  atpa:   T2DPointArray;

  isFishing: Boolean;

    //Reporting values
  timeElapsed  : String;
  timer,xpTimer: TStopWatch;
  xp           : Integer;
  actions      : Integer;

//Settings

Procedure setupLocation();
begin
  writeln("setting up location");
  //Map.Setup([ERSChunk.DRAYNOR_VILLAGE]);
  //anchorPt:= [12348,37518];
  //bankPt  := [12368,37450];
  //fishSpotsTpa:= [[12344,37518],[12340,37510],[12340,37506]];

  //Barbarian Outpost fishing
  Map.Setup([ERSChunk.EDGEVILLE,ERSChunk.VARROCK]);
  anchorPt:= [12436,36698];
  bankPt  := [12740,36686];
  fishSpotsTpa := [[12440,36698],[12440,36702],[12440,36694],[12440,36706],[12440,36710],
  [12416,36734],[12416,36730]];

end;


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Section: Profile and time management
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Procedure endScript(Reason: string);
begin
  TerminateScript(Reason);
end;

Procedure setupLogin();
begin
  profile.Name          := LOGIN_NAME;
  profile.Username      := LOGIN_PASS;
  profile.Password      := PPIN;
  Profiles.Add(LOGIN_NAME,LOGIN_PASS,PPIN);
end;


procedure setupAntiBan();
begin
  Antiban.Skills := [ERSSkill.DEFENCE, ERSSkill.ATTACK, ERSSkill.STRENGTH];
  Antiban.Skills := [ERSSkill.DEFENCE, ERSSkill.ATTACK, ERSSkill.STRENGTH];
  Antiban.AddTask(@Antiban.SmallRandomMouse,    ONE_MINUTE * 1);
  Antiban.AddTask(@Antiban.RandomRightClick,    ONE_MINUTE * 45);
  Antiban.AddTask(@Antiban.SmallCameraRotation, ONE_MINUTE * 11);


  Antiban.AddBreak(ONE_MINUTE*5, ONE_SECOND*40, 0.2, 0.0);   //Short break
  Antiban.AddBreak(ONE_MINUTE*60, ONE_MINUTE*30, 0.2, 0.0);  //Moderate break
  Antiban.AddBreak(ONE_MINUTE*240, ONE_MINUTE*90, 0.2, 0.0);  //Long break
  Antiban.AddBreak(ONE_HOUR*8, ONE_HOUR*5, 0.2, 0.8);        //Sleep
  Antiban.DoAntiban();
end;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Section: Reporting
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
procedure printProgReport();
begin
  Writeln("");
  Writeln("+ Fishing Bot ğŸŸ  ---------------------+");
  Writeln("| Total Time Elapsed:       " + timeElapsed + "  |");
  Writeln("| Bot Time:                 " + toStr(Logger.TimeRunning.ElapsedFmt(TIME_SHORT)) + "  |");
  Writeln("| Antiban Time:             " + toStr(Antiban.TimeRunning.ElapsedFmt(TIME_SHORT)) + "  | ");
  Writeln("+-------------------------------------+");
  Writeln("");
  Writeln("+------------ XP Gained --------------+");
  Writeln("| You have gained: " + toStr(XPBar.TotalEarnedXP) + " XP    ");
  Writeln("| Experience Per Hour: " + toStr((XPBar.TotalEarnedXP/(timer.Elapsed/1000))*3600) + " xp/hr ");
  Writeln("+------------ XP Gained --------------+");
  Writeln("");
end;

procedure bankFish();
var
  i:Integer;
begin
   printProgReport();
   writeln("["+timeElapsed+"]: "+"Inventory is full, banking");
   Map.Walker.WebWalk(bankPt);
   Bank.Open();
   for i:=0 to High(fish) do
   begin
    Inventory.Items.Click(fish[i]);
    Sleep(1500);
   end;
   Sleep(1000);
   Bank.Close();

end;


procedure checkFishingState();
begin
  xp := XPBar.Read();
  if not XPBar.WaitXP(15000) then
  begin
    isFishing := false;
    Writeln("["+timeElapsed+"]: "+ "No longer fishing");
  end
  else
  begin
    isFishing := true;
  end;
end;

procedure findFishingSpots();
begin
  for i:=0 to High(fishingSpots) do
  begin
    fishingSpots[i].Hover();
    if MainScreen.IsUpText('Net Fishing spot ', False, 0.75, 100) then
    begin
      writeln ("["+timeElapsed+"]: "+"Fishing Spot is active");
      Mouse.Click(EMouseButton.LEFT);
      isFishing:= true;
      ShowOnTarget(fishingSpots[i]);
      break;
    end;
  Sleep(2000);
  end;
end;

//Create fishing spots with a color finder
procedure initFishingSpots();
var
  obj : TRSObject;
  tp : Integer;
begin

  for tp := 0 to High(fishSpotsTpa) do
  begin
    obj := TRSObject.Create(@Map.Walker,[1,1,7],[fishSpotsTpa[tp]], ["Net Fishing Spot"]);
    obj.Finder.ColorClusters += [
      [$989084, 0.932, EColorSpace.LCH, [1.663, 1.220, 0.119]],
      [$CBC4C0, 3.820, EColorSpace.LCH, [0.422, 2.298, 0.281]],8
    ];
    fishingSpots.Insert(obj,tp);
  end;
end;

procedure init();
var
  i:Integer;
begin
    setupLocation();
    setupLogin();
    writeln Map.Position();
    player := Map.Position();
    initFishingSpots();
    Inventory.Items.Setup('Inventory.Items', @Inventory.Slots, [0, 0], @Inventory.Open);
    setupAntiban();

    timeElapsed := toStr(GetTimeStamp(TIME_SHORT));
    timer.Start();

    while True do
    begin
      timeElapsed := toStr(GetTimeStamp(TIME_SHORT));
      Minimap.CompassDegrees := 0;
      Sleep(5000);
      ShowOnTarget(fishingSpots);
      checkFishingState();

      if not Inventory.isOpen() then
        Inventory.Open();

      if Inventory.IsFull() then
      begin
        bankFish();
        isFishing := false;
      end;
      Antiban.DoAntiban();

      if not isFishing then
      begin
        Map.Walker.WebWalk(anchorPt);
        for i:=0 to 10 do
        begin
          findFishingSpots();
          if i = 5 then
            Map.Walker.WebWalk( [12412,36734]);
          if isFishing = true then
            break;
          if Inventory.IsFull() then
            break;
        end;
      end;
    end;
end;

begin
    init();
end.
